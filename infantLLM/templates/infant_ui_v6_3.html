<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Infant LLM v6.3 ‚Äî STEM Learner</title>
  <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
  <link rel="stylesheet" href="/static/style.css">
</head>
<body class="infant">
<header>
  <div class="title">
    <img src="/docs/logo.png" alt="Infant LLM Logo">
    <div>
      <h1>Infant LLM v6.3 ‚Äî STEM Learner</h1>
      <p>A living AI experiment that grows through human teaching.</p>
    </div>
  </div>
</header>

<div class="wrap">
  <aside class="sidebar">
    <!-- Growth Summary -->
    <div class="card">
      <h3>Growth Summary</h3>
      <div id="growth-bar" style="height:10px;background:#e2e8f0;border-radius:999px;overflow:hidden;">
        <div id="growth-fill" style="height:10px;width:0%;background:#60a5fa;"></div>
      </div>
      <p id="growth-stats" style="margin-top:8px;font-size:.95em;">Learned: 0 ‚Ä¢ Maturity: 0%</p>
      <p id="growth-stage" class="stage-text">Stage: Infant</p>
    </div>

    <!-- Always-visible instructions -->
    <div class="instructions">
      <h3>Getting Started</h3>
      <p>üë∂ Teach your Infant LLM simple facts, relationships, or math using natural language.</p>
      <ul>
        <li><code>learn cats are mammals</code></li>
        <li><code>learn math: 2+2=4</code></li>
        <li><code>what sound do dogs make?</code></li>
      </ul>
      <p>It grows as it learns ‚Äî evolving from <strong>Infant ‚Üí Child ‚Üí Teenager ‚Üí Adult</strong>.</p>
    </div>

    <!-- Growth Mode + Stage selector -->
    <div class="growth-controls">
      <label for="growth-mode">Growth Mode:</label>
      <select id="growth-mode">
        <option value="auto" selected>Auto</option>
        <option value="manual">Manual</option>
      </select>

    <label for="growth-stage-select">Stage:</label>
      <select id="growth-stage-select" disabled>
        <option value="infant">Infant</option>
        <option value="child">Child</option>
        <option value="teenager">Teenager</option>
        <option value="adult">Adult</option>
      </select>

    </div>

    <div class="card">
      <h3>Settings</h3>
      <label>Mode</label>
      <select id="mode">
        <option value="auto" selected>üß† Auto (Smart Recall)</option>
        <option value="recall">‚öôÔ∏è Exact Recall</option>
        <option value="creative">üé® Creative</option>
      </select><br/><br/>

      <label>Prefer knowledge type</label>
      <select id="pref">
        <option value="any" selected>Any</option>
        <option value="math">Math</option>
        <option value="science">Science</option>
        <option value="coding">Coding</option>
        <option value="engineering">Engineering</option>
        <option value="technology">Technology</option>
        <option value="general">General</option>
      </select>
    </div>

    <div class="card">
      <h3>Memory (recent)</h3>
      <div id="memlist" style="max-height:260px;overflow:auto;font-size:14px;"></div>
      <div style="display:flex;gap:8px;margin-top:8px;">
        <button onclick="refreshMemory()">Refresh</button>
        <button style="background:#dc2626;" onclick="clearMemory()">üßπ Clear Memory</button>
      </div>
      <div class="mt-4 text-center" style="margin-top:10px;text-align:center;">
        <a href="https://github.com/jburishkin/Infant-LLM-v6.3-Full" target="_blank" title="Open GitHub Repository">
          <button style="background: linear-gradient(90deg, #3b82f6, #60a5fa); color: white; border: none; padding: 8px 14px; border-radius: 10px; font-weight: 600; cursor: pointer; transition: 0.3s;"
                  onmouseover="this.style.opacity='0.85'"
                  onmouseout="this.style.opacity='1'">üåê View on GitHub</button>
        </a>
      </div>
    </div>
  </aside>

  <main class="content">
    <div id="chat-output" class="card"></div>
    <div class="card">
      <div class="row">
        <textarea id="user-input" placeholder="Ask or teach‚Ä¶ e.g., 'what is 2+3=' or 'learn math: 2+2=4'"></textarea>
        <button id="send-btn" onclick="send()">Send</button>
      </div>
      <p style="font-size: 0.8em; color: #9aa4b2; text-align: right; margin-top: 4px;">
        ‚èé Press <strong>Enter</strong> to send  |  <strong>Shift+Enter</strong> for a new line
      </p>
      <div id="typing-indicator">ü§î Infant is thinking...</div>
    </div>
  </main>
</div>

<div id="learning-flash"></div>

<footer class="text-center text-sm text-muted mt-6">
  <hr class="my-3" style="opacity:.3;">
  <p>
    <a href="https://github.com/jburishkin/Infant-LLM-v6.3-Full" target="_blank" style="color:inherit;text-decoration:none;">
      Infant LLM v{{ version }} ‚Äî {{ edition }}
    </a>
  </p>
  <p>¬© 2025 Jonathan Burishkin</p>
</footer>

<script>
const typingIndicator = document.getElementById("typing-indicator");
const chat = document.getElementById("chat-output");
const input = document.getElementById("user-input");
const modeSel = document.getElementById("mode");
const prefSel = document.getElementById("pref");

let autoGrowth = true;
const modeGrowthSel = document.getElementById('growth-mode');
const stageSel = document.getElementById('growth-stage-select');

function bubble(text, who){
  const div=document.createElement("div");
  div.className="msg "+(who==="me"?"me":"bot");
  div.innerHTML=text;
  chat.appendChild(div); chat.scrollTop=chat.scrollHeight;
}
function hint(text){
  const div=document.createElement("div");
  div.className="hint"; div.innerHTML="Memory hint: "+text;
  chat.appendChild(div); chat.scrollTop=chat.scrollHeight;
}

function triggerLearningFlash(category="general"){
  const flash = document.getElementById("learning-flash");
  const colors = {
    general: "rgba(34,197,94,0.35)",
    math: "rgba(59,130,246,0.35)",
    science: "rgba(147,51,234,0.35)",
    technology: "rgba(234,179,8,0.35)",
    engineering: "rgba(251,113,133,0.35)"
  };
  flash.style.background = `radial-gradient(circle, ${colors[category]||colors.general} 0%, rgba(0,0,0,0) 70%)`;
  flash.classList.add("active");
  setTimeout(()=>flash.classList.remove("active"), 600);
}

function startThinking(){ document.body.classList.add("thinking"); typingIndicator.classList.add("show"); }
function stopThinking(){ document.body.classList.remove("thinking"); typingIndicator.classList.remove("show"); }

async function send(){
  const text = input.value.trim();
  if(!text) return;
  bubble("<b>You:</b> "+text,"me");
  input.value="";
  startThinking();
  const resp = await fetch("/chat",{method:"POST",headers:{"Content-Type":"application/json"},
    body:JSON.stringify({msg:text,mode:modeSel.value,prefer:prefSel.value})});
  const data = await resp.json();
  stopThinking();

  (data.memory||[]).forEach(m=>hint("["+m.type+"] "+m.text));
  bubble("<b>Infant:</b> "+data.reply,"bot");

  if(data.updated_memory){
    const t=text.toLowerCase();
    let cat="general";
    if(t.includes("math")||/[0-9+\-*/=]/.test(t)) cat="math";
    else if(t.includes("science")) cat="science";
    else if(t.includes("technology")||t.includes("tech")) cat="technology";
    else if(t.includes("engineering")||t.includes("engineer")) cat="engineering";
    triggerLearningFlash(cat);
    refreshMemory();
  }

  if (data.stage){
    updateGrowthStage(data.stage);
  }
  if (data.suggest_growth){
    bubble("<i>üå± I feel ready to grow to <b>"+data.suggest_growth.toUpperCase()+"</b>. Switch stage from the sidebar when you're ready.</i>","bot");
  }
}

function refreshMemory(){
  fetch("/memlist").then(r=>r.json()).then(j=>{
    const box=document.getElementById("memlist");
    if(!j.items||j.items.length===0){ box.innerHTML="<i>Empty</i>"; }
    else { box.innerHTML=j.items.map(it=>`<div>[${it.type}] ${it.text}</div>`).join(""); }
    if(j.stats){
      document.getElementById("growth-stats").innerText = `Learned: ${j.stats.learned} ‚Ä¢ Maturity: ${j.stats.maturity}%`;
      document.getElementById("growth-fill").style.width = j.stats.maturity+"%";
      updateGrowthStage(j.stats.stage||"infant");
      syncGrowthControls(j.stats);
    }
  });
}

function clearMemory(){
  if(!confirm("Are you sure you want to clear all memory?")) return;
  fetch("/clear_memory", {method:"POST"})
  .then(r=>r.json())
  .then(j=>{
    alert(j.reply);
    refreshMemory();
  });
}

function updateGrowthStage(stage){
  document.body.classList.remove("infant","child","teenager","adult");
  document.body.classList.add(stage);
  document.getElementById("growth-stage").textContent = "Stage: "+stage.charAt(0).toUpperCase()+stage.slice(1);
}

function syncGrowthControls(stats){
  const currentStage = (stats.stage || 'infant');
  const override = !!stats.override;
  if (override) {
    modeGrowthSel.value = 'manual';
    stageSel.disabled = false;
  } else {
    modeGrowthSel.value = 'auto';
    stageSel.disabled = true;
  }
  stageSel.value = currentStage;
}

modeGrowthSel.addEventListener('change', (e) => {
  const mode = e.target.value;
  if (mode === 'manual') {
    autoGrowth = false;
    stageSel.disabled = false;
    fetch('/set_stage', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({mode:'manual', stage: stageSel.value})});
  } else {
    autoGrowth = true;
    stageSel.disabled = true;
    fetch('/set_stage', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({mode:'auto'})});
  }
});

stageSel.addEventListener('change', async (e) => {
  if (!autoGrowth) {
    const st = e.target.value;
    updateGrowthStage(st);

    const resp = await fetch('/set_stage', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ mode: 'manual', stage: st })
    });

    const data = await resp.json();
    if (data.maturity !== undefined) {
      const maturity = data.maturity;
      document.getElementById('growth-fill').style.width = maturity + '%';
      document.getElementById('growth-stats').innerText =
        `Learned: 0 ‚Ä¢ Maturity: ${maturity}%`;
    }
  }
});

// Send on Enter
input.addEventListener("keydown", function(e){
  if(e.key==="Enter" && !e.shiftKey){ e.preventDefault(); document.getElementById("send-btn").click(); }
});

// Auto-focus + initial memory load
window.onload=function(){ input.focus(); refreshMemory(); };
</script>
</body>
</html>
