<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Infant LLM v6.3 ‚Äî STEM Learner</title>
  <!-- Favicon set begin-->
  <link rel="icon" type="image/png" sizes="16x16" href="/static/graphics/favicon/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/static/graphics/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/static/graphics/favicon/favicon-96x96.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/static/graphics/favicon/apple-touch-icon.png">
  <link rel="manifest" href="/static/graphics/favicon/site.webmanifest">
  <link rel="shortcut icon" href="/static/graphics/favicon/favicon.ico">
  <meta name="theme-color" content="#60a5fa">
  <!-- Favicon set end-->
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <div class="container">
    <aside class="sidebar">
      <div class="card">
        <h3>Growth Summary</h3>
        <div id="growth-bar">
          <div id="growth-fill"></div>
        </div>
        <p id="growth-stats">Learned: 0 ‚Ä¢ Maturity: 0%</p>
        <p id="growth-stage" class="stage-text">Stage: Infant</p>
      </div>

      <div class="instructions">
        <h3>Getting Started</h3>
        <p>üë∂ Teach your Infant LLM simple facts, relationships, or math using natural language:</p>
        <ul>
          <li><code>learn cats are mammals</code></li>
          <li><code>learn math: 2+2=4</code></li>
          <li><code>what sound do dogs make?</code></li>
        </ul>
        <p>It evolves through <strong>Infant ‚Üí Child ‚Üí Teenager ‚Üí Adult</strong> as you teach it.</p>
      </div>

      <div class="growth-controls">
        <label for="growth-mode">Growth Mode:</label>
        <select id="growth-mode">
          <option value="auto" selected>Auto</option>
          <option value="manual">Manual</option>
        </select>

        <label for="growth-stage-select">Stage:</label>
        <select id="growth-stage-select" disabled>
          <option value="infant">Infant</option>
          <option value="child">Child</option>
          <option value="teenager">Teenager</option>
          <option value="adult">Adult</option>
        </select>
      </div>

      <div class="card memory-card">
        <h3>Memory (recent)</h3>
        <div id="memlist"></div>
        <div class="button-row">
          <button onclick="refreshMemory()">Refresh</button>
          <button class="danger" onclick="clearMemory()">üßπ Clear Memory</button>
        </div>
        <div class="github-link">
          <a href="https://github.com/jburishkin/Infant-LLM-v6.3-Full" target="_blank">
            <button class="github-btn">üåê View on GitHub</button>
          </a>
        </div>
      </div>
    </aside>

    <main class="chat-area">
      <header class="title">
        <h1>Infant LLM v6.3 ‚Äî STEM Learner</h1>
        <p class="subtitle">A living AI experiment that grows through human teaching.</p>
      </header>

      <div id="chatbox" class="chatbox"></div>

      <div class="input-row">
        <input type="text" id="user-input" placeholder="Type here to teach or ask..." />
        <button id="send-btn">Send</button>
      </div>
    </main>
  </div>

  <script>
    const chatbox = document.getElementById("chatbox");
    const input = document.getElementById("user-input");
    const sendBtn = document.getElementById("send-btn");
    const growthMode = document.getElementById("growth-mode");
    const growthStageSel = document.getElementById("growth-stage-select");

    function appendMessage(sender, text, cls) {
      const msg = document.createElement("div");
      msg.className = `msg ${cls}`;
      msg.innerHTML = `<div class="bubble"><strong>${sender}:</strong> ${text}</div>`;
      chatbox.appendChild(msg);
    }

    async function sendMessage() {
      const text = input.value.trim();
      if (!text) return;
      appendMessage("You", text, "user");
      input.value = "";

      const mode = document.getElementById("mode") ? document.getElementById("mode").value : "auto";
      const pref = document.getElementById("pref") ? document.getElementById("pref").value : "any";

      const res = await fetch("/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ msg: text, mode, prefer: pref })
      });
      const data = await res.json();
      appendMessage("Infant", data.reply, "infant");

      if (data.updated_memory) {
        const fill = document.getElementById("growth-fill");
        const currentStage = document.getElementById("growth-stage").innerText.toLowerCase().replace("stage: ", "");
        fill.classList.remove("infant","child","teenager","adult","shimmer-once");
        fill.classList.add(currentStage,"shimmer-once");
        setTimeout(() => fill.classList.remove("shimmer-once"), 3000);
        refreshMemory();
      }
    }

    sendBtn.onclick = sendMessage;
    input.addEventListener("keypress", e => { if (e.key === "Enter") sendMessage(); });

    async function refreshMemory() {
      const res = await fetch("/memlist");
      const data = await res.json();
      document.getElementById("memlist").innerHTML =
        data.items.map(i => `<div>[${i.type}] ${i.text}</div>`).join("");
      document.getElementById("growth-stats").innerText =
        `Learned: ${data.stats.learned} ‚Ä¢ Maturity: ${data.stats.maturity}%`;
      document.getElementById("growth-stage").innerText =
        `Stage: ${data.stats.stage[0].toUpperCase() + data.stats.stage.slice(1)}`;
      const fill = document.getElementById("growth-fill");
      fill.style.width = data.stats.maturity + "%";
      fill.dataset.stage = data.stats.stage;
      // keep class in sync for shimmer color
      fill.classList.remove("infant","child","teenager","adult");
      fill.classList.add(data.stats.stage);
    }

    async function clearMemory() {
      await fetch("/clear_memory", { method: "POST" });
      chatbox.innerHTML = "";
      refreshMemory();
    }

    growthMode.addEventListener("change", async () => {
      const manual = growthMode.value === "manual";
      growthStageSel.disabled = !manual;
      await fetch("/set_stage", {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({mode: growthMode.value, stage: growthStageSel.value})
      });
      refreshMemory();
    });

    growthStageSel.addEventListener("change", async () => {
      if (!growthStageSel.disabled) {
        await fetch("/set_stage", {
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body: JSON.stringify({mode:"manual", stage: growthStageSel.value})
        });
        refreshMemory();
      }
    });

    // Optional extra settings (present in some builds)
    // Safe guards so missing selects don't error
    if (!document.getElementById("mode")) {
      const stubMode = document.createElement("select");
      stubMode.id = "mode";
      stubMode.style.display = "none";
      document.body.appendChild(stubMode);
      stubMode.value = "auto";
    }
    if (!document.getElementById("pref")) {
      const stubPref = document.createElement("select");
      stubPref.id = "pref";
      stubPref.style.display = "none";
      document.body.appendChild(stubPref);
      stubPref.value = "any";
    }

    // Initial load
    refreshMemory();
  </script>
</body>
</html>
